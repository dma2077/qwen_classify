model:
  pretrained_name: "/llm_reco/dehua/model/Qwen2.5-VL-7B-Instruct"
  num_labels: 101  # Food101çš„ç±»åˆ«æ•°

# æŸå¤±å‡½æ•°é…ç½®
loss:
  type: "label_smoothing"  # é€‰é¡¹: cross_entropy, focal, label_smoothing, arcface, symmetric_ce
  smoothing: 0.1
  temperature: 1.0

# ç»Ÿä¸€é¢‘ç‡è®¾ç½®ï¼ˆæ¨èä¸”å”¯ä¸€æ”¯æŒçš„æ–¹å¼ï¼‰
monitor:
  freq:
    training_log_freq: 20      # è®­ç»ƒæŒ‡æ ‡è®°å½•é¢‘ç‡
    eval_log_freq: 1            # è¯„ä¼°æŒ‡æ ‡è®°å½•é¢‘ç‡
    perf_log_freq: 50          # æ€§èƒ½æŒ‡æ ‡è®°å½•é¢‘ç‡
    gpu_log_freq: 50           # GPUç›‘æ§é¢‘ç‡
    flops_profile_freq: 50     # MFUè®¡ç®—é¢‘ç‡ (ä½¿ç”¨profiler)
    local_save_freq: 500       # æœ¬åœ°æ—¥å¿—ä¿å­˜é¢‘ç‡
    progress_update_freq: 50    # è¿›åº¦æ›´æ–°é¢‘ç‡

# å•æ•°æ®é›†é…ç½® - ğŸ”¥ å·²ä¿®å¤ï¼ševal_ratioç°åœ¨å¯ä»¥æ­£ç¡®å·¥ä½œ
datasets:
  dataset_configs:
    food101:
      num_classes: 101
      description: "Food-101 dataset"
      eval_ratio: 0.01  # ğŸ”¥ ä¿®å¤åï¼šè®­ç»ƒè¿‡ç¨‹ä¸­åªè¯„ä¼°1%çš„æ•°æ®ï¼Œå¤§å¹…æå‡é€Ÿåº¦
  # å•æ•°æ®é›†ä¸éœ€è¦logits masking
  enable_logits_masking: false
  # å•æ•°æ®é›†ä¸éœ€è¦shuffle
  shuffle_datasets: false

data:
  # å•æ•°æ®é›†ä½¿ç”¨åŸå§‹æ ¼å¼
  train_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/food101_train.jsonl"
  val_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/food101_test.jsonl"

training:
  epochs: 5
  lr: 5e-6
  weight_decay: 0.01
  warmup_steps: 200
  output_dir: "/mmu_mllm_hdd_2/madehua/model/qwen_classify/food101_ls_5e_6_fixed_eval"
  logging_steps: 50
  save_steps: 200
  eval_steps: 200
  save_hf_format: true
  save_deepspeed_format: false
  
  # å­¦ä¹ ç‡è°ƒåº¦å™¨é…ç½®
  lr_scheduler:
    type: "cosine"
    final_lr_ratio: 0.1
    num_cycles: 0.5
  
  # æœ€ä½³æ¨¡å‹è¿½è¸ªé…ç½®
  best_model_tracking:
    enabled: true
    metric: "overall_accuracy"
    mode: "max"
    save_best_only: true
  
  # è¯„ä¼°é…ç½® - ğŸ”¥ å·²ä¿®å¤ï¼šéƒ¨åˆ†è¯„ä¼°ç°åœ¨èƒ½æ­£ç¡®å·¥ä½œ
  evaluation:
    partial_eval_during_training: true  # è®­ç»ƒè¿‡ç¨‹ä¸­è¿›è¡Œéƒ¨åˆ†è¯„ä¼°ï¼ˆä½¿ç”¨eval_ratioï¼‰
    full_eval_at_end: true             # è®­ç»ƒç»“æŸåè¿›è¡Œå®Œæ•´è¯„ä¼°ï¼ˆ100%æ•°æ®ï¼‰
    eval_best_model_only: true         # åªå¯¹æœ€ä½³æ¨¡å‹è¿›è¡Œå®Œæ•´è¯„ä¼°

# å…¶ä»–é…ç½®
optimizer:
  type: "adamw"
  lr: 5e-6
  weight_decay: 0.01
  eps: 1e-8

deepspeed:
  config_path: "configs/ds_s2_as_8.json"

wandb:
  enabled: true
  project: "qwen_classify_fixed_eval"
  name: "food101_ls_5e_6_fixed_eval"
  log_code: false
  log_dataset_metrics: true
  
# ğŸ“‹ ä¿®å¤è¯´æ˜ï¼š
# 1. ç°åœ¨å•æ•°æ®é›†æ¨¡å¼ä¸‹ eval_ratio å¯ä»¥æ­£ç¡®å·¥ä½œ
# 2. eval_ratio: 0.01 è¡¨ç¤ºè®­ç»ƒè¿‡ç¨‹ä¸­åªä½¿ç”¨1%çš„éªŒè¯æ•°æ®è¿›è¡Œè¯„ä¼°
# 3. å®Œæ•´è¯„ä¼°ä»ç„¶ä½¿ç”¨100%çš„æ•°æ®ï¼ˆè®­ç»ƒç»“æŸæ—¶ï¼‰
# 4. è¿™å¤§å¹…æå‡äº†è®­ç»ƒé€Ÿåº¦ï¼Œç‰¹åˆ«æ˜¯å¤§æ•°æ®é›†çš„æƒ…å†µä¸‹ 