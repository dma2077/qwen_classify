model:
  pretrained_name: "/llm_reco/dehua/model/Qwen2.5-VL-7B-Instruct"
  num_labels: 101  # Food101的类别数

# 损失函数配置
loss:
  type: "label_smoothing"  # 选项: cross_entropy, focal, label_smoothing, arcface, symmetric_ce
  smoothing: 0.1
  temperature: 1.0

# 统一频率设置（推荐且唯一支持的方式）
monitor:
  freq:
    training_log_freq: 20      # 训练指标记录频率
    eval_log_freq: 1            # 评估指标记录频率
    perf_log_freq: 50          # 性能指标记录频率
    gpu_log_freq: 50           # GPU监控频率
    flops_profile_freq: 50     # MFU计算频率 (使用profiler)
    local_save_freq: 500       # 本地日志保存频率
    progress_update_freq: 50    # 进度更新频率

# 单数据集配置 - 🔥 已修复：eval_ratio现在可以正确工作
datasets:
  dataset_configs:
    food101:
      num_classes: 101
      description: "Food-101 dataset"
      eval_ratio: 0.01  # 🔥 修复后：训练过程中只评估1%的数据，大幅提升速度
  # 单数据集不需要logits masking
  enable_logits_masking: false
  # 单数据集不需要shuffle
  shuffle_datasets: false

data:
  # 单数据集使用原始格式
  train_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/food101_train.jsonl"
  val_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/food101_test.jsonl"

training:
  epochs: 5
  lr: 5e-6
  weight_decay: 0.01
  warmup_steps: 200
  output_dir: "/mmu_mllm_hdd_2/madehua/model/qwen_classify/food101_ls_5e_6_fixed_eval"
  logging_steps: 50
  save_steps: 200
  eval_steps: 200
  save_hf_format: true
  save_deepspeed_format: false
  
  # 学习率调度器配置
  lr_scheduler:
    type: "cosine"
    final_lr_ratio: 0.1
    num_cycles: 0.5
  
  # 最佳模型追踪配置
  best_model_tracking:
    enabled: true
    metric: "overall_accuracy"
    mode: "max"
    save_best_only: true
  
  # 评估配置 - 🔥 已修复：部分评估现在能正确工作
  evaluation:
    partial_eval_during_training: true  # 训练过程中进行部分评估（使用eval_ratio）
    full_eval_at_end: true             # 训练结束后进行完整评估（100%数据）
    eval_best_model_only: true         # 只对最佳模型进行完整评估

# 其他配置
optimizer:
  type: "adamw"
  lr: 5e-6
  weight_decay: 0.01
  eps: 1e-8

deepspeed:
  config_path: "configs/ds_s2_as_8.json"

wandb:
  enabled: true
  project: "qwen_classify_fixed_eval"
  name: "food101_ls_5e_6_fixed_eval"
  log_code: false
  log_dataset_metrics: true
  
# 📋 修复说明：
# 1. 现在单数据集模式下 eval_ratio 可以正确工作
# 2. eval_ratio: 0.01 表示训练过程中只使用1%的验证数据进行评估
# 3. 完整评估仍然使用100%的数据（训练结束时）
# 4. 这大幅提升了训练速度，特别是大数据集的情况下 