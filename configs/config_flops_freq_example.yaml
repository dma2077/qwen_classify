model:
  pretrained_name: "Qwen/Qwen2.5-VL-7B-Instruct"
  num_labels: 10

# æŸå¤±å‡½æ•°é…ç½®
loss:
  type: "cross_entropy"

data:
  train_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/food101_train.jsonl"
  val_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/food101_test.jsonl"

training:
  epochs: 2
  lr: 1e-5
  weight_decay: 0.01
  warmup_steps: 10
  output_dir: "/mmu_mllm_hdd_2/madehua/model/qwen_classify/flops_freq_example"
  logging_steps: 1
  save_steps: 10
  eval_steps: 5
  save_hf_format: true
  save_deepspeed_format: false
  num_workers: 4
  use_fused_adam: true
  
  # æœ€ä½³æ¨¡å‹è¿½è¸ªé…ç½®
  best_model_tracking:
    enabled: true
    metric: "overall_accuracy"
    mode: "max"
    save_best_only: true
  
  # è¯„ä¼°é…ç½®
  evaluation:
    partial_eval_during_training: true
    full_eval_at_end: true
    eval_best_model_only: true

# ğŸ”¥ å…³é”®é…ç½®ï¼šç›‘æ§é¢‘ç‡ - ç°åœ¨å¯ä»¥åœ¨yamlä¸­è®¾ç½®MFUè®¡ç®—é¢‘ç‡
monitor:
  freq:
    # æ‰€æœ‰é¢‘ç‡éƒ½ç‹¬ç«‹é…ç½®
    training_log_freq: 50      # è®­ç»ƒæŒ‡æ ‡è®°å½•é¢‘ç‡
    eval_log_freq: 1           # è¯„ä¼°æŒ‡æ ‡è®°å½•é¢‘ç‡
    perf_log_freq: 100         # æ€§èƒ½æŒ‡æ ‡è®°å½•é¢‘ç‡
    gpu_log_freq: 100          # GPUç›‘æ§é¢‘ç‡
    flops_profile_freq: 100    # ğŸ”¥ MFUè®¡ç®—é¢‘ç‡ (ä½¿ç”¨profiler) - ç°åœ¨å¯ä»¥åœ¨yamlä¸­è®¾ç½®ï¼
    local_save_freq: 1000      # æœ¬åœ°æ—¥å¿—ä¿å­˜é¢‘ç‡
    progress_update_freq: 100   # è¿›åº¦æ›´æ–°é¢‘ç‡

# DeepSpeedé…ç½®
deepspeed:
  config_file: "configs/ds_s2.json"
  zero_stage: 2
  bf16: true

# Weights & Biasesé…ç½®
wandb:
  enabled: true
  project: "qwen-classification"
  run_name: "flops_freq_example"
  tags: ["qwen", "deepspeed", "classification", "flops_freq_example"]
  notes: "æµ‹è¯•flops_profile_freqé…ç½®åŠŸèƒ½"
  log_dataset_metrics: false
  log_overall_metrics: true

# Legacy accelerate settings
accelerate:
  bf16: true

# ä½¿ç”¨è¯´æ˜
# =============================================================================
# 
# ğŸ”¥ flops_profile_freq é…ç½®è¯´æ˜ï¼š
# 
# 1. åŠŸèƒ½ï¼šæ§åˆ¶ä½¿ç”¨PyTorch Profilerè®¡ç®—MFUçš„é¢‘ç‡
# 2. è®¾ç½®ä½ç½®ï¼šmonitor.freq.flops_profile_freq
# 3. é»˜è®¤å€¼ï¼š500ï¼ˆå¦‚æœæœªè®¾ç½®ï¼‰
# 
# æ¨èè®¾ç½®ï¼š
# - è°ƒè¯•é˜¶æ®µï¼š10-50ï¼ˆé¢‘ç¹è®¡ç®—ï¼Œä¾¿äºè°ƒè¯•ï¼‰
# - å¼€å‘é˜¶æ®µï¼š100-200ï¼ˆå¹³è¡¡ç²¾åº¦å’Œæ€§èƒ½ï¼‰
# - ç”Ÿäº§é˜¶æ®µï¼š200-500ï¼ˆå‡å°‘æ€§èƒ½å¼€é”€ï¼‰
# 
# æ³¨æ„äº‹é¡¹ï¼š
# - æ¯flops_profile_freqæ­¥ä¼šä½¿ç”¨profilerè¿›è¡Œç²¾ç¡®çš„MFUè®¡ç®—
# - å…¶ä»–æ­¥éª¤ä½¿ç”¨åŸºäºå®é™…FLOPsçš„ä¼°ç®—MFU
# - å»ºè®®ä¸perf_log_freqä¿æŒä¸€è‡´æˆ–ä¸ºå…¶å€æ•°
# 
# ç¤ºä¾‹é…ç½®ï¼š
# - flops_profile_freq: 50   # æ¯50æ­¥ç²¾ç¡®è®¡ç®—MFU
# - flops_profile_freq: 100  # æ¯100æ­¥ç²¾ç¡®è®¡ç®—MFU
# - flops_profile_freq: 200  # æ¯200æ­¥ç²¾ç¡®è®¡ç®—MFU
# 
# ============================================================================= 