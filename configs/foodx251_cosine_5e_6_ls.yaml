model:
  pretrained_name: "/llm_reco/dehua/model/Qwen2.5-VL-7B-Instruct"
  num_labels: 251  # Food101çš„ç±»åˆ«æ•°

# æŸå¤±å‡½æ•°é…ç½®
loss:
  type: "label_smoothing"  # é€‰é¡¹: cross_entropy, focal, label_smoothing, arcface, symmetric_ce
  smoothing: 0.1
  temperature: 1.0

# ç»Ÿä¸€é¢‘ç‡è®¾ç½®ï¼ˆæ¨èä¸”å”¯ä¸€æ”¯æŒçš„æ–¹å¼ï¼‰
monitor:
  freq:
    training_log_freq: 20      # è®­ç»ƒæŒ‡æ ‡è®°å½•é¢‘ç‡
    eval_log_freq: 1            # è¯„ä¼°æŒ‡æ ‡è®°å½•é¢‘ç‡
    perf_log_freq: 50          # æ€§èƒ½æŒ‡æ ‡è®°å½•é¢‘ç‡
    gpu_log_freq: 50           # GPUç›‘æ§é¢‘ç‡
    flops_profile_freq: 50     # MFUè®¡ç®—é¢‘ç‡ (ä½¿ç”¨profiler)
    local_save_freq: 500       # æœ¬åœ°æ—¥å¿—ä¿å­˜é¢‘ç‡
    progress_update_freq: 50    # è¿›åº¦æ›´æ–°é¢‘ç‡

# å•æ•°æ®é›†é…ç½®
datasets:
  dataset_configs:
    foodx251:
      num_classes: 251
      description: "Foodx251 dataset"
      eval_ratio: 1  # è®­ç»ƒè¿‡ç¨‹ä¸­è¯„ä¼°20%çš„æ•°æ®
  # å•æ•°æ®é›†ä¸éœ€è¦logits masking
  enable_logits_masking: false
  # å•æ•°æ®é›†ä¸éœ€è¦shuffle
  shuffle_datasets: false

data:
  # å•æ•°æ®é›†ä½¿ç”¨åŸå§‹æ ¼å¼
  train_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/foodx251_train.jsonl"
  val_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/foodx251_test.jsonl"

training:
  epochs: 5
  lr: 5e-6
  weight_decay: 0.01
  warmup_steps: 0.1
  output_dir: "/mmu_mllm_hdd_2/madehua/model/qwen_classify/foodx251_ls_5e_6"
  logging_steps: 10000
  save_steps: 200
  eval_steps: 200
  save_hf_format: true
  save_deepspeed_format: false
  num_workers: 16  # æ¢å¤åŸå§‹è®¾ç½®ï¼Œä»£ç ä¼šè‡ªåŠ¨è°ƒæ•´
  use_fused_adam: true
  gradient_checkpointing: false

  # å­¦ä¹ ç‡è°ƒåº¦å™¨é…ç½®
  lr_scheduler:
    type: "cosine"  # ä½™å¼¦è°ƒåº¦å™¨
    final_lr_ratio: 0.1  # æœ€ç»ˆå­¦ä¹ ç‡ä¸ºåˆå§‹å­¦ä¹ ç‡çš„5% (20å€è¡°å‡)
    num_cycles: 0.5  # ä½™å¼¦å‘¨æœŸæ•°
  
  # æœ€ä½³æ¨¡å‹è¿½è¸ªé…ç½®
  best_model_tracking:
    enabled: true
    metric: "overall_accuracy"  # è¿½è¸ªçš„æŒ‡æ ‡
    mode: "max"  # max æˆ– min
    save_best_only: true  # æ˜¯å¦åªä¿å­˜æœ€ä½³æ¨¡å‹
  
  # è¯„ä¼°é…ç½®
  evaluation:
    partial_eval_during_training: true  # è®­ç»ƒè¿‡ç¨‹ä¸­æ˜¯å¦è¿›è¡Œéƒ¨åˆ†è¯„ä¼°
    full_eval_at_end: true  # è®­ç»ƒç»“æŸåæ˜¯å¦è¿›è¡Œå®Œæ•´è¯„ä¼°
    eval_best_model_only: true  # æ˜¯å¦åªå¯¹æœ€ä½³æ¨¡å‹è¿›è¡Œå®Œæ•´è¯„ä¼°

# DeepSpeed specific settings - ğŸ”¥ ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„é…ç½®æ–‡ä»¶è·¯å¾„
deepspeed:
  config_file: "configs/ds_s2_as_8.json"  # ä¿®å¤è·¯å¾„åŒ¹é…
  zero_stage: 2
  bf16: true

# Weights & Biases configuration
wandb:
  enabled: false
  project: "qwen_classification"
  run_name: "foodx251_cosine_5e_6_ls"
  tags: ["qwen", "deepspeed", "classification", "cosine_hold", "single_dataset"]
  notes: "Qwen2.5-VL Food101 classification with cosine+hold scheduler"
  log_dataset_metrics: false  # å•æ•°æ®é›†ä¸éœ€è¦æŒ‰æ•°æ®é›†åˆ†ç»„çš„æŒ‡æ ‡
  log_overall_metrics: true   # è®°å½•æ•´ä½“æŒ‡æ ‡

# Legacy accelerate settings (for compatibility)
accelerate:
  bf16: true 