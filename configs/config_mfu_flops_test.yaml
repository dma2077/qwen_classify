model:
  pretrained_name: "Qwen/Qwen2.5-VL-7B-Instruct"
  num_labels: 10

# æŸå¤±å‡½æ•°é…ç½®
loss:
  type: "cross_entropy"

data:
  train_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/food101_train.jsonl"
  val_jsonl: "/llm_reco/dehua/code/qwen_classify/data/dataset_food_label/food101_test.jsonl"

training:
  epochs: 2  # çŸ­è®­ç»ƒç”¨äºæµ‹è¯•
  lr: 1e-5
  weight_decay: 0.01
  warmup_steps: 10
  output_dir: "/mmu_mllm_hdd_2/madehua/model/qwen_classify/mfu_flops_test"
  logging_steps: 1  # æ¯æ­¥éƒ½è®°å½•
  save_steps: 10
  eval_steps: 5  # é¢‘ç¹è¯„ä¼°
  save_hf_format: true
  save_deepspeed_format: false
  num_workers: 4
  use_fused_adam: true
  
  # æœ€ä½³æ¨¡å‹è¿½è¸ªé…ç½®
  best_model_tracking:
    enabled: true
    metric: "overall_accuracy"
    mode: "max"
    save_best_only: true
  
  # è¯„ä¼°é…ç½®
  evaluation:
    partial_eval_during_training: true
    full_eval_at_end: true
    eval_best_model_only: true

# ğŸ”¥ å…³é”®é…ç½®ï¼šç›‘æ§é¢‘ç‡ - ç¡®ä¿MFUå’ŒFLOPsæŒ‡æ ‡èƒ½æ­£ç¡®æ˜¾ç¤º
monitor:
  freq:
    # æ‰€æœ‰é¢‘ç‡éƒ½ç‹¬ç«‹é…ç½®ï¼Œç¡®ä¿æŒ‡æ ‡æ­£å¸¸æ˜¾ç¤º
    training_log_freq: 1    # æ¯æ­¥è®°å½•è®­ç»ƒæŒ‡æ ‡
    perf_log_freq: 2        # æ¯2æ­¥è®°å½•æ€§èƒ½æŒ‡æ ‡ï¼ˆåŒ…æ‹¬MFUå’ŒFLOPsï¼‰
    gpu_log_freq: 3         # æ¯3æ­¥è®°å½•GPUæŒ‡æ ‡
    flops_profile_freq: 4   # æ¯4æ­¥ä½¿ç”¨profilerè®¡ç®—MFUï¼ˆæ›´ç²¾ç¡®ï¼‰
    local_save_freq: 5      # æ¯5æ­¥ä¿å­˜æœ¬åœ°æ—¥å¿—

# DeepSpeedé…ç½®
deepspeed:
  config_file: "configs/ds_s2.json"
  zero_stage: 2
  bf16: true

# Weights & Biasesé…ç½® - ä¸“é—¨ç”¨äºæµ‹è¯•MFUå’ŒFLOPsæŒ‡æ ‡
wandb:
  enabled: true
  project: "qwen-classification"
  run_name: "mfu_flops_test"
  tags: ["qwen", "deepspeed", "classification", "mfu_test", "flops_test"]
  notes: "æµ‹è¯•MFUå’ŒFLOPsæŒ‡æ ‡æ˜¾ç¤ºåŠŸèƒ½"
  log_dataset_metrics: false  # å•æ•°æ®é›†
  log_overall_metrics: true

# Legacy accelerate settings
accelerate:
  bf16: true 