# WandB æŒ‡æ ‡è®°å½•å®Œæ•´æŒ‡å—

## ğŸ“Š æŒ‡æ ‡è®°å½•ä¿è¯

ç»è¿‡ä¼˜åŒ–åï¼Œæ‰€æœ‰æŒ‡æ ‡éƒ½æœ‰å®Œæ•´çš„ `commit=True` ä¿è¯ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚

## ğŸ¯ æŒ‡æ ‡åˆ†ç»„

### 1. Training ç»„ (`training/`)
**è®°å½•é¢‘ç‡**: æ¯ä¸ªæœ‰æ•ˆè®­ç»ƒæ­¥
**è®°å½•æ–¹æ³•**: `monitor.log_step()`

- `training/loss` - è®­ç»ƒæŸå¤± âœ… **æ¯æ­¥è®°å½•**
- `training/lr` - å­¦ä¹ ç‡ âœ… **æ¯æ­¥è®°å½•**  
- `training/grad_norm` - æ¢¯åº¦èŒƒæ•° âœ… **æ¯æ­¥è®°å½•**
- `training/epoch` - å½“å‰epoch âœ… **æ¯æ­¥è®°å½•**
- `global_step` - å…¨å±€æ­¥æ•° âœ… **æ¯æ­¥è®°å½•**

**Epochçº§åˆ«æŒ‡æ ‡**:
- `training/epoch_avg_loss` - Epochå¹³å‡æŸå¤± âœ…
- `training/epoch_time` - Epochè€—æ—¶ âœ…
- `training/epoch_number` - Epochç¼–å· âœ…

**è®­ç»ƒçŠ¶æ€**:
- `training/started` - è®­ç»ƒå¼€å§‹æ ‡è®° âœ…
- `training/finished` - è®­ç»ƒç»“æŸæ ‡è®° âœ…
- `training/total_time` - æ€»è®­ç»ƒæ—¶é—´ âœ…

### 2. Performance ç»„ (`perf/`)
**è®°å½•é¢‘ç‡**: æ¯10æ­¥è®°å½•ä¸€æ¬¡ï¼ˆå‡å°‘å¼€é”€ï¼‰
**è®°å½•æ–¹æ³•**: `monitor.log_step()` å†…éƒ¨

- `perf/step_time` - å•æ­¥è€—æ—¶ âœ…
- `perf/mfu` - æ¨¡å‹FLOPsåˆ©ç”¨ç‡ âœ… 
- `perf/tokens_per_second` - æ¯ç§’å¤„ç†tokensæ•° âœ…
- `perf/actual_flops` - å®é™…FLOPs âœ…
- `perf/actual_seq_length` - å®é™…åºåˆ—é•¿åº¦ âœ…
- `perf/real_time_measurement` - å®æ—¶æµ‹é‡æ ‡è®° âœ…
- `perf/flops_per_second` - æ¯ç§’FLOPs âœ…

### 3. Evaluation ç»„ (`eval/`)
**è®°å½•é¢‘ç‡**: æ¯ `eval_steps` æ­¥ï¼ˆé»˜è®¤500æ­¥ï¼‰
**è®°å½•æ–¹æ³•**: `monitor.log_metrics()` é€šè¿‡ `evaluate()`

**æ•´ä½“æŒ‡æ ‡**:
- `eval/overall_loss` - æ•´ä½“è¯„ä¼°æŸå¤± âœ…
- `eval/overall_accuracy` - æ•´ä½“è¯„ä¼°å‡†ç¡®ç‡ âœ…
- `eval/overall_samples` - æ•´ä½“æ ·æœ¬æ•° âœ…
- `eval/overall_correct` - æ•´ä½“æ­£ç¡®æ•° âœ…

**å¤šæ•°æ®é›†æƒ…å†µ**:
- `eval/{dataset_name}_loss` - å„æ•°æ®é›†æŸå¤± âœ…
- `eval/{dataset_name}_accuracy` - å„æ•°æ®é›†å‡†ç¡®ç‡ âœ…
- `eval/{dataset_name}_samples` - å„æ•°æ®é›†æ ·æœ¬æ•° âœ…

**å•æ•°æ®é›†æƒ…å†µ**:
- `eval/loss` - è¯„ä¼°æŸå¤± âœ…
- `eval/accuracy` - è¯„ä¼°å‡†ç¡®ç‡ âœ…

**æœ€ç»ˆè¯„ä¼°**:
- `eval/final_overall_loss` - æœ€ç»ˆæ•´ä½“æŸå¤± âœ…
- `eval/final_overall_accuracy` - æœ€ç»ˆæ•´ä½“å‡†ç¡®ç‡ âœ…
- `eval/final_{dataset_name}_loss` - å„æ•°æ®é›†æœ€ç»ˆæŸå¤± âœ…
- `eval/final_{dataset_name}_accuracy` - å„æ•°æ®é›†æœ€ç»ˆå‡†ç¡®ç‡ âœ…

## ğŸ”§ è®°å½•æ–¹æ³•è¯¦è§£

### æ ¸å¿ƒè®°å½•å‡½æ•°

1. **`monitor.log_step()`** - è®­ç»ƒæ­¥éª¤æŒ‡æ ‡
   - æ¯ä¸ªæœ‰æ•ˆè®­ç»ƒæ­¥è°ƒç”¨
   - è®°å½•trainingå’Œperfç»„æŒ‡æ ‡
   - ä½¿ç”¨ `commit=True` ç¡®ä¿æ•°æ®æäº¤

2. **`monitor.log_epoch()`** - Epochçº§åˆ«æŒ‡æ ‡
   - æ¯ä¸ªepochç»“æŸæ—¶è°ƒç”¨
   - è®°å½•epochç»Ÿè®¡ä¿¡æ¯
   - ä½¿ç”¨ `commit=True` ç¡®ä¿æ•°æ®æäº¤

3. **`monitor.log_metrics()`** - é€šç”¨æŒ‡æ ‡è®°å½•
   - ç”¨äºevalæŒ‡æ ‡è®°å½•
   - æ”¯æŒè‡ªå®šä¹‰commitå‚æ•°
   - é»˜è®¤ `commit=True`

4. **`monitor.log_evaluation()`** - è¯„ä¼°æŒ‡æ ‡è®°å½•
   - ä¸“é—¨ç”¨äºè¯„ä¼°ç»“æœ
   - ä½¿ç”¨ `commit=True` ç¡®ä¿æ•°æ®æäº¤

## âš¡ æ€§èƒ½ä¼˜åŒ–

### é¢‘ç‡æ§åˆ¶
- **åŸºç¡€è®­ç»ƒæŒ‡æ ‡**: æ¯æ­¥è®°å½•ï¼ˆloss, lr, grad_norm, epochï¼‰
- **æ€§èƒ½æŒ‡æ ‡**: æ¯10æ­¥è®°å½•ï¼ˆå‡å°‘å¼€é”€ï¼‰
- **è¯„ä¼°æŒ‡æ ‡**: æ¯ `eval_steps` è®°å½•
- **æœ¬åœ°æ—¥å¿—ä¿å­˜**: æ¯100æ­¥ä¿å­˜

### åˆ†å¸ƒå¼è®­ç»ƒä¼˜åŒ–
- åªæœ‰ä¸»è¿›ç¨‹ï¼ˆrank 0ï¼‰è®°å½•åˆ°wandb
- éä¸»è¿›ç¨‹ä½¿ç”¨ `DummyMonitor`ï¼Œé›¶å¼€é”€
- é¿å…é‡å¤è®°å½•å’Œç½‘ç»œå¼€é”€

## ğŸš¨ å…³é”®ä¿®å¤

### ä¿®å¤å‰çš„é—®é¢˜
1. **commité€»è¾‘é”™è¯¯**: éƒ¨åˆ†æŒ‡æ ‡ä½¿ç”¨ `commit=False` ä½†æ²¡æœ‰åç»­æäº¤
2. **ç©ºè®°å½•**: å­˜åœ¨ `wandb.log({}, commit=True)` ç©ºè°ƒç”¨
3. **ä¸ä¸€è‡´çš„commit**: ä¸åŒæ–¹æ³•ä½¿ç”¨ä¸åŒçš„commitç­–ç•¥
4. **æ•°æ®ä¸¢å¤±é£é™©**: åŸºç¡€æŒ‡æ ‡å¯èƒ½æœªè¢«æ­£ç¡®æäº¤

### ä¿®å¤åçš„ä¿è¯
1. **æ‰€æœ‰wandb.logè°ƒç”¨éƒ½ä½¿ç”¨ `commit=True`**
2. **ä¸€æ¬¡æ€§è®°å½•**: é¿å…å¤šæ¬¡åˆ†ç¦»çš„logè°ƒç”¨
3. **ç»Ÿä¸€çš„commitç­–ç•¥**: æ‰€æœ‰è®°å½•æ–¹æ³•ä¿æŒä¸€è‡´
4. **æ•°æ®å®Œæ•´æ€§**: ç¡®ä¿æ‰€æœ‰æŒ‡æ ‡éƒ½è¢«æ­£ç¡®è®°å½•å’Œæäº¤

## ğŸ“ˆ WandBç•Œé¢é¢„æœŸç»“æ„

```
ğŸ“Š WandB Dashboard:
â”œâ”€â”€ ğŸ“ˆ training/
â”‚   â”œâ”€â”€ loss, lr, grad_norm, epoch (æ¯æ­¥)
â”‚   â”œâ”€â”€ epoch_avg_loss, epoch_time (æ¯epoch)
â”‚   â””â”€â”€ started, finished, total_time (çŠ¶æ€)
â”œâ”€â”€ âš¡ perf/
â”‚   â”œâ”€â”€ step_time, mfu (æ¯10æ­¥)
â”‚   â”œâ”€â”€ tokens_per_second, actual_flops
â”‚   â””â”€â”€ real_time_measurement, flops_per_second
â””â”€â”€ ğŸ“Š eval/
    â”œâ”€â”€ overall_loss, overall_accuracy (æ•´ä½“)
    â”œâ”€â”€ {dataset}_loss, {dataset}_accuracy (å„æ•°æ®é›†)
    â””â”€â”€ final_* (æœ€ç»ˆè¯„ä¼°)
```

## âœ… éªŒè¯æ¸…å•

- [x] æ‰€æœ‰è®­ç»ƒæŒ‡æ ‡æ­£ç¡®è®°å½•
- [x] æ‰€æœ‰è¯„ä¼°æŒ‡æ ‡æ­£ç¡®è®°å½•  
- [x] æ‰€æœ‰æ€§èƒ½æŒ‡æ ‡æ­£ç¡®è®°å½•
- [x] åˆ†å¸ƒå¼è®­ç»ƒå…¼å®¹
- [x] commitå‚æ•°ä¸€è‡´æ€§
- [x] æ— æ•°æ®ä¸¢å¤±é£é™©
- [x] é¢‘ç‡æ§åˆ¶ä¼˜åŒ–
- [x] é”™è¯¯å¤„ç†å®Œå–„

æ‰€æœ‰æŒ‡æ ‡ç°åœ¨éƒ½æœ‰**100%çš„è®°å½•ä¿è¯**ï¼ğŸ‰ 