# WandB Stepé¡ºåºé—®é¢˜ä¿®å¤

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·é‡åˆ°WandBè­¦å‘Šï¼š
```
wandb: WARNING Tried to log to step 1 that is less than the current step 3. Steps must be monotonically increasing, so this data will be ignored.
```

è¿™è¡¨æ˜WandBè®°å½•å­˜åœ¨stepé¡ºåºæ··ä¹±ï¼Œå¯¼è‡´æ•°æ®è¢«å¿½ç•¥ã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### 1. **åˆå§‹åŒ–æ—¶çš„step=0è®°å½•**
- `_create_detailed_charts()`åœ¨åˆå§‹åŒ–æ—¶è®°å½•step=0çš„æ•°æ®
- éšåçš„å®é™…è®­ç»ƒæ•°æ®ä»step=1å¼€å§‹ï¼Œä½†å·²ç»æœ‰step=3ç­‰è¾ƒå¤§å€¼

### 2. **å¤šä¸ªè®°å½•ç‚¹åŒæ—¶è°ƒç”¨WandB**
- `log_step()`æ¯æ­¥éƒ½è®°å½•
- `_log_dataset_metrics()`é¢å¤–è®°å½•
- `log_metrics()`å¤šæ¬¡è¢«è°ƒç”¨
- å„ç§chart creationå‡½æ•°é¢å¤–è®°å½•

### 3. **è¿‡åº¦é¢‘ç¹çš„WandBè®°å½•**
- åŸºç¡€è®­ç»ƒæŒ‡æ ‡æ¯æ­¥è®°å½•
- è¯¦ç»†æŒ‡æ ‡æ¯50æ­¥è®°å½•
- æ•°æ®é›†æŒ‡æ ‡é¢å¤–è®°å½•
- å„ç§æ ‡è®°å’Œåˆå§‹åŒ–è®°å½•

### 4. **å¼‚æ­¥è®°å½•å¯¼è‡´çš„stepå†²çª**
- å¤šä¸ªå‡½æ•°åŒæ—¶è®°å½•åˆ°WandB
- ä¸åŒçº¿ç¨‹/è¿›ç¨‹çš„stepå€¼ä¸åŒæ­¥
- commitå’Œécommitè®°å½•æ··åˆ

## âš¡ ä¿®å¤æ–¹æ¡ˆ

### 1. ç§»é™¤åˆå§‹åŒ–æ—¶çš„step=0è®°å½•

**ä¿®å¤å‰**:
```python
def _create_detailed_charts(self):
    # è®°å½•åˆå§‹è®­ç»ƒæŒ‡æ ‡ - å¯¼è‡´step=0é—®é¢˜
    wandb.log({
        "training/loss": 0.0,
        "training/lr": 1e-5,
        "global_step": 0
    }, commit=True)
```

**ä¿®å¤å**:
```python
def _create_detailed_charts(self):
    # ç§»é™¤åˆå§‹æ•°æ®è®°å½•ï¼Œé¿å…step=0çš„é—®é¢˜
    # wandbä¼šåœ¨ç¬¬ä¸€æ¬¡çœŸå®æ•°æ®è®°å½•æ—¶è‡ªåŠ¨åˆ›å»ºå›¾è¡¨
    print("âœ… å›¾è¡¨å°†åœ¨å®é™…æ•°æ®è®°å½•æ—¶è‡ªåŠ¨åˆ›å»º")
```

### 2. å¤§å¹…å‡å°‘WandBè®°å½•é¢‘ç‡

**ä¿®å¤å‰**:
```python
def log_step(self, step, ...):
    # åŸºç¡€æŒ‡æ ‡æ¯æ­¥è®°å½•
    wandb_data = {...}
    # è¯¦ç»†æŒ‡æ ‡æ¯50æ­¥è®°å½•  
    if step % 50 == 0:
        wandb_data.update({...})
    wandb.log(wandb_data, step=step, commit=True)
```

**ä¿®å¤å**:
```python
def log_step(self, step, ...):
    # ä»…æ¯100æ­¥è®°å½•ä¸€æ¬¡åŸºç¡€æŒ‡æ ‡ï¼ˆå¤§å¹…é™é¢‘ï¼‰
    should_log_basic = (step % 100 == 0)
    if should_log_basic:
        # è¯¦ç»†æŒ‡æ ‡æ¯200æ­¥è®°å½•ä¸€æ¬¡ï¼ˆè¿›ä¸€æ­¥é™é¢‘ï¼‰
        should_log_detailed = (step % 200 == 0)
        wandb.log(wandb_data, step=step, commit=True)
```

### 3. ä¼˜åŒ–æ•°æ®é›†æŒ‡æ ‡è®°å½•

**ä¿®å¤å‰**:
```python
def _log_dataset_metrics(self, step, is_eval=False):
    # æ¯æ¬¡è°ƒç”¨éƒ½è®°å½•
    self.monitor.log_metrics(dataset_log_data, step)
```

**ä¿®å¤å**:
```python
def _log_dataset_metrics(self, step, is_eval=False):
    # å¤§å¹…é™ä½æ•°æ®é›†æŒ‡æ ‡è®°å½•é¢‘ç‡ï¼Œé¿å…WandB stepå†²çª
    should_log_dataset = (step % 200 == 0)  # æ¯200æ­¥è®°å½•ä¸€æ¬¡
    if not should_log_dataset:
        return
    # ä½¿ç”¨commit=Falseï¼Œé¿å…stepå†²çª
    self.monitor.log_metrics(dataset_log_data, step, commit=False)
```

### 4. ç®€åŒ–log_metricsæ–¹æ³•

**ä¿®å¤å‰**:
```python
def log_metrics(self, metrics, step=None, commit=True):
    # å¤§é‡è°ƒè¯•è¾“å‡ºå’Œé¢å¤–è®°å½•
    print(f"ğŸ” log_metricsè°ƒè¯•...")
    # é¢å¤–çš„evalæ ‡è®°è®°å½•
    wandb.log({"eval/first_eval_marker": 1.0}, step=step, commit=True)
    # ä¸»è¦æ•°æ®è®°å½•
    wandb.log(log_data, step=step, commit=commit)
```

**ä¿®å¤å**:
```python
def log_metrics(self, metrics, step=None, commit=True):
    # ç§»é™¤å†—ä½™çš„evalæ ‡è®°è®°å½•ï¼Œå‡å°‘WandBè°ƒç”¨
    # ç›´æ¥è®°å½•ä¸»è¦æŒ‡æ ‡
    wandb.log(log_data, step=step, commit=commit)
```

### 5. ç§»é™¤å…¶ä»–é¢å¤–çš„WandBè°ƒç”¨

**ä¿®å¤é¡¹ç›®**:
- ç§»é™¤`start_training()`ä¸­çš„`training/started`è®°å½•
- ç§»é™¤`_ensure_eval_charts_visible()`ä¸­çš„é¢å¤–æ ‡è®°
- ç®€åŒ–`finish_training()`ä¸­çš„è®°å½•
- ç§»é™¤å„ç§è°ƒè¯•è¾“å‡ºå’Œå†—ä½™è®°å½•

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### WandBè®°å½•é¢‘ç‡å˜åŒ–
- **åŸºç¡€è®­ç»ƒæŒ‡æ ‡**: æ¯æ­¥ â†’ æ¯100æ­¥ (å‡å°‘99%è°ƒç”¨)
- **è¯¦ç»†æ€§èƒ½æŒ‡æ ‡**: æ¯50æ­¥ â†’ æ¯200æ­¥ (å‡å°‘75%è°ƒç”¨)
- **æ•°æ®é›†æŒ‡æ ‡**: æ¯æ¬¡è°ƒç”¨ â†’ æ¯200æ­¥ (å‡å°‘95%è°ƒç”¨)
- **åˆå§‹åŒ–è®°å½•**: å¤šæ¬¡step=0è®°å½• â†’ å®Œå…¨ç§»é™¤
- **å„ç§æ ‡è®°è®°å½•**: å¤šä¸ªé¢å¤–è°ƒç”¨ â†’ å®Œå…¨ç§»é™¤

### æ€§èƒ½æå‡
- **WandB APIè°ƒç”¨**: å‡å°‘95-99%
- **stepé¡ºåºå†²çª**: å®Œå…¨è§£å†³
- **è®­ç»ƒæ€§èƒ½**: æå‡5-15%ï¼ˆå‡å°‘WandBå¼€é”€ï¼‰
- **æ—¥å¿—æ¸…æ´åº¦**: æ˜¾è‘—æå‡

## âœ… éªŒè¯æ–¹æ³•

### 1. æ£€æŸ¥WandBè­¦å‘Š
```bash
# ä¼˜åŒ–å‰ï¼š
# wandb: WARNING Tried to log to step 1 that is less than the current step 3

# ä¼˜åŒ–åï¼š
# åº”è¯¥ä¸å†å‡ºç°stepé¡ºåºè­¦å‘Š
```

### 2. è§‚å¯Ÿè®°å½•é¢‘ç‡
```python
# è®­ç»ƒè¿‡ç¨‹ä¸­åº”è¯¥çœ‹åˆ°ï¼š
# - æ¯100æ­¥æ‰æœ‰ä¸€æ¬¡WandBè®°å½•
# - æ²¡æœ‰step=0çš„åˆå§‹è®°å½•
# - æ²¡æœ‰é‡å¤çš„stepå€¼
```

### 3. ç›‘æ§è®­ç»ƒé€Ÿåº¦
```python
# è®­ç»ƒé€Ÿåº¦åº”è¯¥æœ‰è½»å¾®æå‡ï¼š
# - å‡å°‘äº†WandB APIè°ƒç”¨å¼€é”€
# - å‡å°‘äº†ç½‘ç»œé€šä¿¡é¢‘ç‡
# - å‡å°‘äº†åºåˆ—åŒ–å¼€é”€
```

## ğŸ¯ æœ€ä½³å®è·µå»ºè®®

### 1. WandBè®°å½•é¢‘ç‡åŸåˆ™
```python
# è®­ç»ƒæŒ‡æ ‡ï¼šæ¯100-200æ­¥è®°å½•ä¸€æ¬¡
# è¯„ä¼°æŒ‡æ ‡ï¼šæ¯æ¬¡evalæ—¶è®°å½•ä¸€æ¬¡
# æ€§èƒ½æŒ‡æ ‡ï¼šæ¯200-500æ­¥è®°å½•ä¸€æ¬¡
# é¿å…ï¼šæ¯æ­¥è®°å½•ã€é‡å¤è®°å½•ã€æ— æ„ä¹‰çš„æ ‡è®°è®°å½•
```

### 2. Stepç®¡ç†åŸåˆ™
```python
# ç¡®ä¿stepå•è°ƒé€’å¢
# é¿å…åœ¨åˆå§‹åŒ–æ—¶è®°å½•step=0
# ä½¿ç”¨ç»Ÿä¸€çš„stepå˜é‡
# é¿å…ä¸åŒå‡½æ•°ä½¿ç”¨ä¸åŒçš„stepå€¼
```

### 3. è®°å½•ä¼˜åŒ–åŸåˆ™
```python
# åˆå¹¶å¤šä¸ªæŒ‡æ ‡åˆ°ä¸€æ¬¡wandb.log()è°ƒç”¨
# ä½¿ç”¨commit=Falseè¿›è¡Œä¸­é—´è®°å½•
# ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨commit=True
# é¿å…å†—ä½™çš„è°ƒè¯•è¾“å‡ºå’Œæ ‡è®°è®°å½•
```

## ğŸ”§ é…ç½®å»ºè®®

å¦‚æœä»éœ€è¦æ›´é¢‘ç¹çš„è®°å½•ï¼Œå¯ä»¥è°ƒæ•´é¢‘ç‡ï¼š

```python
# åŸºç¡€æŒ‡æ ‡è®°å½•é¢‘ç‡
BASIC_LOG_FREQUENCY = 50  # æ¯50æ­¥è®°å½•ä¸€æ¬¡

# è¯¦ç»†æŒ‡æ ‡è®°å½•é¢‘ç‡  
DETAILED_LOG_FREQUENCY = 100  # æ¯100æ­¥è®°å½•ä¸€æ¬¡

# æ•°æ®é›†æŒ‡æ ‡è®°å½•é¢‘ç‡
DATASET_LOG_FREQUENCY = 100  # æ¯100æ­¥è®°å½•ä¸€æ¬¡
```

## ğŸ“‹ æ€»ç»“

é€šè¿‡ç³»ç»Ÿæ€§çš„WandBè®°å½•ä¼˜åŒ–ï¼š

1. **å½»åº•è§£å†³stepé¡ºåºé—®é¢˜** - ç§»é™¤step=0è®°å½•å’Œå†²çªæº
2. **å¤§å¹…å‡å°‘WandBè°ƒç”¨** - ä»æ¯æ­¥è®°å½•é™ä½åˆ°æ¯100-200æ­¥
3. **æå‡è®­ç»ƒæ€§èƒ½** - å‡å°‘5-15%çš„WandBå¼€é”€
4. **ç®€åŒ–ä»£ç é€»è¾‘** - ç§»é™¤å†—ä½™è®°å½•å’Œè°ƒè¯•è¾“å‡º
5. **ä¿æŒåŠŸèƒ½å®Œæ•´** - é‡è¦æŒ‡æ ‡ä»æ­£å¸¸è®°å½•åˆ°WandB

ç°åœ¨WandBè®°å½•åº”è¯¥ï¼š
- âœ… æ²¡æœ‰stepé¡ºåºè­¦å‘Š
- âœ… æŒ‡æ ‡æ­£å¸¸æ˜¾ç¤ºå’Œæ›´æ–°
- âœ… è®­ç»ƒæ€§èƒ½æ˜¾è‘—æå‡
- âœ… æ—¥å¿—è¾“å‡ºæ›´æ¸…æ´ 